/**
  * UPYUN js-sdk 3.4.2
  * (c) 2020
  * @license MIT
  */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("axios")):"function"==typeof define&&define.amd?define(["axios"],t):e.upyun=t(e.axios)}(this,function(d){"use strict";d="default"in d?d.default:d;var s="undefined"!=typeof window&&("undefined"==typeof process||"browser"===process.title),u=1048576,m=e;function e(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}m.default=e;var y=2147483647,g=36,b=1,x=26,w=38,A=700,j=72,k=128,C="-",a=/[^\x20-\x7E]/,i=/[\x2E\u3002\uFF0E\uFF61]/g,t={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},O=g-b,S=Math.floor,P=String.fromCharCode;function q(e){throw new RangeError(t[e])}function h(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function T(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function l(e){for(var t,r,n,o,a,i,s,u,h,l,c,f=[],p=(e=function(e){for(var t,r,n=[],o=0,a=e.length;o<a;)55296<=(t=e.charCodeAt(o++))&&t<=56319&&o<a?56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--):n.push(t);return n}(e)).length,v=k,d=j,m=t=0;m<p;++m)(u=e[m])<128&&f.push(P(u));for(r=n=f.length,n&&f.push(C);r<p;){for(o=y,m=0;m<p;++m)v<=(u=e[m])&&u<o&&(o=u);for(o-v>S((y-t)/(h=r+1))&&q("overflow"),t+=(o-v)*h,v=o,m=0;m<p;++m)if((u=e[m])<v&&++t>y&&q("overflow"),u==v){for(a=t,i=g;!(a<(s=i<=d?b:d+x<=i?x:i-d));i+=g)c=a-s,l=g-s,f.push(P(T(s+c%l,0))),a=S(c/l);f.push(P(T(a,0))),d=function(e,t,r){var n=0;for(e=r?S(e/A):e>>1,e+=S(e/t);O*x>>1<e;n+=g)e=S(e/O);return S(n+(O+1)*e/(e+w))}(t,h,r==n),t=0,++r}++t,++v}return f.join("")}function z(e){return r=function(e){return a.test(e)?"xn--"+l(e):e},n=(t=e).split("@"),o="",1<n.length&&(o=n[0]+"@",t=n[1]),o+h((t=t.replace(i,".")).split("."),r).join(".");var t,r,n,o}"function"==typeof global.setTimeout&&setTimeout,"function"==typeof global.clearTimeout&&clearTimeout;global.performance;function E(e){return null===e}function B(e){return"string"==typeof e}function f(e){return"object"==typeof e&&null!==e}Object.create;var I=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function p(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function v(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var U=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t};function N(e,t,r,n){t=t||"&",r=r||"=";var o={};if("string"!=typeof e||0===e.length)return o;var a=/\+/g;e=e.split(t);var i=1e3;n&&"number"==typeof n.maxKeys&&(i=n.maxKeys);var s=e.length;0<i&&i<s&&(s=i);for(var u,h,l=0;l<s;++l){var c,f=e[l].replace(a,"%20"),p=f.indexOf(r),v=0<=p?(c=f.substr(0,p),f.substr(p+1)):(c=f,""),d=decodeURIComponent(c),m=decodeURIComponent(v);u=o,h=d,Object.prototype.hasOwnProperty.call(u,h)?I(o[d])?o[d].push(m):o[d]=[o[d],m]:o[d]=m}return o}var c={parse:o,resolve:function(e,t){return o(e,!1,!0).resolve(t)},resolveObject:function(e,t){return e?o(e,!1,!0).resolveObject(t):t},format:function(e){B(e)&&(e=W({},e));return Y(e)},Url:M};function M(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var R=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,F=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,r=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),_=["'"].concat(r),L=["%","/","?",";","#"].concat(_),D=["/","?","#"],H=255,Z=/^[+a-z0-9A-Z_-]{0,63}$/,G=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,$={javascript:!0,"javascript:":!0},J={javascript:!0,"javascript:":!0},K={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function o(e,t,r){if(e&&f(e)&&e instanceof M)return e;var n=new M;return n.parse(e,t,r),n}function W(e,t,r,n){if(!B(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var o=t.indexOf("?"),a=-1!==o&&o<t.indexOf("#")?"?":"#",i=t.split(a);i[0]=i[0].replace(/\\/g,"/");var s=(s=t=i.join(a)).trim();if(!n&&1===t.split("#").length){var u=F.exec(s);if(u)return e.path=s,e.href=s,e.pathname=u[1],u[2]?(e.search=u[2],e.query=r?N(e.search.substr(1)):e.search.substr(1)):r&&(e.search="",e.query={}),e}var h,l,c,f,p=R.exec(s);if(p&&(h=(p=p[0]).toLowerCase(),e.protocol=h,s=s.substr(p.length)),(n||p||s.match(/^\/\/[^@\/]+@[^@\/]+/))&&(!(l="//"===s.substr(0,2))||p&&J[p]||(s=s.substr(2),e.slashes=!0)),!J[p]&&(l||p&&!K[p])){var v,d,m=-1;for(b=0;b<D.length;b++)-1!==(c=s.indexOf(D[b]))&&(-1===m||c<m)&&(m=c);for(-1!==(d=-1===m?s.lastIndexOf("@"):s.lastIndexOf("@",m))&&(v=s.slice(0,d),s=s.slice(d+1),e.auth=decodeURIComponent(v)),m=-1,b=0;b<L.length;b++)-1!==(c=s.indexOf(L[b]))&&(-1===m||c<m)&&(m=c);-1===m&&(m=s.length),e.host=s.slice(0,m),s=s.slice(m),X(e),e.hostname=e.hostname||"";var y="["===e.hostname[0]&&"]"===e.hostname[e.hostname.length-1];if(!y)for(var g=e.hostname.split(/\./),b=0,x=g.length;b<x;b++){var w=g[b];if(w&&!w.match(Z)){for(var A="",j=0,k=w.length;j<k;j++)127<w.charCodeAt(j)?A+="x":A+=w[j];if(!A.match(Z)){var C=g.slice(0,b),O=g.slice(b+1),S=w.match(G);S&&(C.push(S[1]),O.unshift(S[2])),O.length&&(s="/"+O.join(".")+s),e.hostname=C.join(".");break}}}e.hostname.length>H?e.hostname="":e.hostname=e.hostname.toLowerCase(),y||(e.hostname=z(e.hostname)),f=e.port?":"+e.port:"";var P=e.hostname||"";e.host=P+f,e.href+=e.host,y&&(e.hostname=e.hostname.substr(1,e.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!$[h])for(b=0,x=_.length;b<x;b++){var q,T=_[b];-1!==s.indexOf(T)&&((q=encodeURIComponent(T))===T&&(q=escape(T)),s=s.split(T).join(q))}var E=s.indexOf("#");-1!==E&&(e.hash=s.substr(E),s=s.slice(0,E));var I,U=s.indexOf("?");return-1!==U?(e.search=s.substr(U),e.query=s.substr(U+1),r&&(e.query=N(e.query)),s=s.slice(0,U)):r&&(e.search="",e.query={}),s&&(e.pathname=s),K[h]&&e.hostname&&!e.pathname&&(e.pathname="/"),(e.pathname||e.search)&&(f=e.pathname||"",I=e.search||"",e.path=f+I),e.href=Y(e),e}function Y(e){var t=e.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var r,n,o,a,i=e.protocol||"",s=e.pathname||"",u=e.hash||"",h=!1,l="";e.host?h=t+e.host:e.hostname&&(h=t+(-1===e.hostname.indexOf(":")?e.hostname:"["+this.hostname+"]"),e.port&&(h+=":"+e.port)),e.query&&f(e.query)&&Object.keys(e.query).length&&(r=e.query,n=n||"&",o=o||"=",null===r&&(r=void 0),l="object"==typeof r?v(U(r),function(e){var t=encodeURIComponent(p(e))+o;return I(r[e])?v(r[e],function(e){return t+encodeURIComponent(p(e))}).join(n):t+encodeURIComponent(p(r[e]))}).join(n):a?encodeURIComponent(p(a))+o+encodeURIComponent(p(r)):"");var c=e.search||l&&"?"+l||"";return i&&":"!==i.substr(-1)&&(i+=":"),e.slashes||(!i||K[i])&&!1!==h?(h="//"+(h||""),s&&"/"!==s.charAt(0)&&(s="/"+s)):h=h||"",u&&"#"!==u.charAt(0)&&(u="#"+u),c&&"?"!==c.charAt(0)&&(c="?"+c),i+h+(s=s.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(c=c.replace("#","%23"))+u}function X(e){var t=e.host,r=n.exec(t);r&&(":"!==(r=r[0])&&(e.port=r.substr(1)),t=t.substr(0,t.length-r.length)),t&&(e.hostname=t)}M.prototype.parse=function(e,t,r){return W(this,e,t,r)},M.prototype.format=function(){return Y(this)},M.prototype.resolve=function(e){return this.resolveObject(o(e,!1,!0)).format()},M.prototype.resolveObject=function(e){var t;B(e)&&((t=new M).parse(e,!1,!0),e=t);for(var r,n,o=new M,a=Object.keys(this),i=0;i<a.length;i++){var s=a[i];o[s]=this[s]}if(o.hash=e.hash,""===e.href)return o.href=o.format(),o;if(e.slashes&&!e.protocol){for(var u=Object.keys(e),h=0;h<u.length;h++){var l=u[h];"protocol"!==l&&(o[l]=e[l])}return K[o.protocol]&&o.hostname&&!o.pathname&&(o.path=o.pathname="/"),o.href=o.format(),o}if(e.protocol&&e.protocol!==o.protocol){if(!K[e.protocol]){for(var c=Object.keys(e),f=0;f<c.length;f++){var p=c[f];o[p]=e[p]}return o.href=o.format(),o}if(o.protocol=e.protocol,e.host||J[e.protocol])o.pathname=e.pathname;else{for(w=(e.pathname||"").split("/");w.length&&!(e.host=w.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==w[0]&&w.unshift(""),w.length<2&&w.unshift(""),o.pathname=w.join("/")}return o.search=e.search,o.query=e.query,o.host=e.host||"",o.auth=e.auth,o.hostname=e.hostname||e.host,o.port=e.port,(o.pathname||o.search)&&(r=o.pathname||"",n=o.search||"",o.path=r+n),o.slashes=o.slashes||e.slashes,o.href=o.format(),o}var v,d=o.pathname&&"/"===o.pathname.charAt(0),m=e.host||e.pathname&&"/"===e.pathname.charAt(0),y=m||d||o.host&&e.pathname,g=y,b=o.pathname&&o.pathname.split("/")||[],x=o.protocol&&!K[o.protocol],w=e.pathname&&e.pathname.split("/")||[];if(x&&(o.hostname="",o.port=null,o.host&&(""===b[0]?b[0]=o.host:b.unshift(o.host)),o.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===w[0]?w[0]=e.host:w.unshift(e.host)),e.host=null),y=y&&(""===w[0]||""===b[0])),m)o.host=e.host||""===e.host?e.host:o.host,o.hostname=e.hostname||""===e.hostname?e.hostname:o.hostname,o.search=e.search,o.query=e.query,b=w;else if(w.length)(b=b||[]).pop(),b=b.concat(w),o.search=e.search,o.query=e.query;else if(null!=e.search)return x&&(o.hostname=o.host=b.shift(),(v=!!(o.host&&0<o.host.indexOf("@"))&&o.host.split("@"))&&(o.auth=v.shift(),o.host=o.hostname=v.shift())),o.search=e.search,o.query=e.query,E(o.pathname)&&E(o.search)||(o.path=(o.pathname?o.pathname:"")+(o.search?o.search:"")),o.href=o.format(),o;if(!b.length)return o.pathname=null,o.search?o.path="/"+o.search:o.path=null,o.href=o.format(),o;for(var A=b.slice(-1)[0],j=(o.host||e.host||1<b.length)&&("."===A||".."===A)||""===A,k=0,C=b.length;0<=C;C--)"."===(A=b[C])?b.splice(C,1):".."===A?(b.splice(C,1),k++):k&&(b.splice(C,1),k--);if(!y&&!g)for(;k--;)b.unshift("..");!y||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),j&&"/"!==b.join("/").substr(-1)&&b.push("");var O=""===b[0]||b[0]&&"/"===b[0].charAt(0);return x&&(o.hostname=o.host=!O&&b.length?b.shift():"",(v=!!(o.host&&0<o.host.indexOf("@"))&&o.host.split("@"))&&(o.auth=v.shift(),o.host=o.hostname=v.shift())),(y=y||o.host&&b.length)&&!O&&b.unshift(""),b.length?o.pathname=b.join("/"):(o.pathname=null,o.path=null),E(o.pathname)&&E(o.search)||(o.path=(o.pathname?o.pathname:"")+(o.search?o.search:"")),o.auth=e.auth||o.auth,o.slashes=o.slashes||e.slashes,o.href=o.format(),o},M.prototype.parseHost=function(){return X(this)};var Q=d.defaults.adapter;d.defaults.adapter=s?Q:require("axios/lib/adapters/http");var V=function(e,o,a){var t=(3<arguments.length&&void 0!==arguments[3]?arguments[3]:{}).proxy,r=d.create({baseURL:e+"/"+o.serviceName,maxRedirects:0,proxy:t});return r.interceptors.request.use(function(t){var e=t.method.toUpperCase(),r=c.resolve("/",t.url||"");0===r.indexOf(t.baseURL)&&(r=r.substring(t.baseURL.length)),t.url=encodeURI(t.url);var n=a(o,e,r,t.headers["Content-MD5"]);return(n=m(n)?n:Promise.resolve(n)).then(function(e){return t.headers.common=e,Promise.resolve(t)})},function(e){throw new Error("upyun - request failed: "+e.message)}),r.interceptors.response.use(function(e){return e},function(e){var t=e.response;if(void 0===t)throw e;if(404===t.status)return t;if(t.data&&t.data.msg)throw new Error("upyun - "+t.data.msg);throw new Error("upyun - response error: "+e.message)}),r};var ee={readBlockAsync:function(n,o,a){return new Promise(function(e,t){var r=n.slice||n.mozSlice||n.webkitSlice;return r?e(r.call(n,o,a)):t(new Error("not support File type!"))})}};function te(e,t){for(var r=0,n=e.length-1;0<=n;n--){var o=e[n];"."===o?e.splice(n,1):".."===o?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;)e.unshift("..");return e}function re(e){return ne.exec(e).slice(1)}var ne=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;function oe(){for(var e="",t=!1,r=arguments.length-1;-1<=r&&!t;r--){var n=0<=r?arguments[r]:"/";if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");n&&(e=n+"/"+e,t="/"===n.charAt(0))}return(t?"/":"")+(e=te(ue(e.split("/"),function(e){return!!e}),!t).join("/"))||"."}function ae(e){var t=ie(e),r="/"===he(e,-1);return(e=te(ue(e.split("/"),function(e){return!!e}),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e}function ie(e){return"/"===e.charAt(0)}var se={extname:function(e){return re(e)[3]},basename:function(e,t){var r=re(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},dirname:function(e){var t=re(e),r=t[0],n=t[1];return r||n?r+(n=n&&n.substr(0,n.length-1)):"."},sep:"/",delimiter:":",relative:function(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;0<=r&&""===e[r];r--);return r<t?[]:e.slice(t,r-t+1)}e=oe(e).substr(1),t=oe(t).substr(1);for(var n=r(e.split("/")),o=r(t.split("/")),a=Math.min(n.length,o.length),i=a,s=0;s<a;s++)if(n[s]!==o[s]){i=s;break}for(var u=[],s=i;s<n.length;s++)u.push("..");return(u=u.concat(o.slice(i))).join("/")},join:function(){return ae(ue(Array.prototype.slice.call(arguments,0),function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},isAbsolute:ie,normalize:ae,resolve:oe};function ue(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}var he="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)};var le=function(e,t,a,s){function w(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function A(e,t){return e<<t|e>>>32-t}function u(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var r,n,o,a,i,s=[80],u=1732584193,h=-271733879,l=-1732584194,c=271733878,f=-1009589776,p=0;p<e.length;p+=16){for(var v=u,d=h,m=l,y=c,g=f,b=0;b<80;b++){s[b]=b<16?e[p+b]:A(s[b-3]^s[b-8]^s[b-14]^s[b-16],1);var x=w(w(A(u,5),(o=h,a=l,i=c,(n=b)<20?o&a|~o&i:!(n<40)&&n<60?o&a|o&i|a&i:o^a^i)),w(w(f,s[b]),(r=b)<20?1518500249:r<40?1859775393:r<60?-1894007588:-899497514)),f=c,c=l,l=A(h,30),h=u,u=x}u=w(u,v),h=w(h,d),l=w(l,m),c=w(c,y),f=w(f,g)}return[u,h,l,c,f]}function h(e){for(var t=[],r=(1<<s)-1,n=0;n<e.length*s;n+=s)t[n>>5]|=(e.charCodeAt(n/8)&r)<<32-s-n%32;return t}return a=a||"=",s=s||8,function(e){for(var t="",r=0;r<4*e.length;r+=3)for(var n=(e[r>>2]>>8*(3-r%4)&255)<<16|(e[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|e[r+2>>2]>>8*(3-(r+2)%4)&255,o=0;o<4;o++)8*r+6*o>32*e.length?t+=a:t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>6*(3-o)&63);return t}(function(e,t){var r=h(e);16<r.length&&(r=u(r,e.length*s));for(var n=[16],o=[16],a=0;a<16;a++)n[a]=909522486^r[a],o[a]=1549556828^r[a];var i=u(n.concat(h(t)),512+t.length*s);return u(o.concat(i),672)}(e,t))},ce="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function fe(e,t){return e(t={exports:{}},t.exports),t.exports}function pe(e){return null!=e&&(be(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&be(t.slice(0,0))||!!e._isBuffer);var t}var ve=fe(function(u,c){!function(e){var t=c,r=u&&u.exports==t&&u,n="object"==typeof ce&&ce;n.global!==n&&n.window!==n||(e=n);function o(e){this.message=e}(o.prototype=new Error).name="InvalidCharacterError";function h(e){throw new o(e)}var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=/[\t\n\f\r ]/g,a={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&h("The string to be encoded contains characters outside of the Latin1 range.");for(var t,r,n,o,a=e.length%3,i="",s=-1,u=e.length-a;++s<u;)t=e.charCodeAt(s)<<16,r=e.charCodeAt(++s)<<8,n=e.charCodeAt(++s),i+=l.charAt((o=t+r+n)>>18&63)+l.charAt(o>>12&63)+l.charAt(o>>6&63)+l.charAt(63&o);return 2==a?(t=e.charCodeAt(s)<<8,r=e.charCodeAt(++s),i+=l.charAt((o=t+r)>>10)+l.charAt(o>>4&63)+l.charAt(o<<2&63)+"="):1==a&&(o=e.charCodeAt(s),i+=l.charAt(o>>2)+l.charAt(o<<4&63)+"=="),i},decode:function(e){var t=(e=String(e).replace(s,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),t%4!=1&&!/[^+a-zA-Z0-9/]/.test(e)||h("Invalid character: the string to be decoded is not correctly encoded.");for(var r,n,o=0,a="",i=-1;++i<t;)n=l.indexOf(e.charAt(i)),r=o%4?64*r+n:n,o++%4&&(a+=String.fromCharCode(255&r>>(-2*o&6)));return a},version:"0.1.0"};if(0,t&&!t.nodeType)if(r)r.exports=a;else for(var i in a)a.hasOwnProperty(i)&&(t[i]=a[i]);else e.base64=a}(ce)}),de="3.4.2",me=fe(function(e){var a,r;a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&r.rotl(e,8)|4278255360&r.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=r.endian(e[t]);return e},randomBytes:function(e){for(var t=[];0<e;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var t=[],r=0;r<e.length;r+=3)for(var n=e[r]<<16|e[r+1]<<8|e[r+2],o=0;o<4;o++)8*r+6*o<=8*e.length?t.push(a.charAt(n>>>6*(3-o)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],r=0,n=0;r<e.length;n=++r%4)0!=n&&t.push((a.indexOf(e.charAt(r-1))&Math.pow(2,-2*n+8)-1)<<2*n|a.indexOf(e.charAt(r))>>>6-2*n);return t}},e.exports=r}),ye={utf8:{stringToBytes:function(e){return ye.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(ye.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}},ge=ye;function be(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var xe=fe(function(e){var y,g,b,x,w;y=me,g=ge.utf8,b=pe,x=ge.bin,(w=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?x.stringToBytes(e):g.stringToBytes(e):b(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||(e=e.toString());for(var r=y.bytesToWords(e),n=8*e.length,o=1732584193,a=-271733879,i=-1732584194,s=271733878,u=0;u<r.length;u++)r[u]=16711935&(r[u]<<8|r[u]>>>24)|4278255360&(r[u]<<24|r[u]>>>8);r[n>>>5]|=128<<n%32,r[14+(64+n>>>9<<4)]=n;for(var h=w._ff,l=w._gg,c=w._hh,f=w._ii,u=0;u<r.length;u+=16){var p=o,v=a,d=i,m=s,o=h(o,a,i,s,r[u+0],7,-680876936),s=h(s,o,a,i,r[u+1],12,-389564586),i=h(i,s,o,a,r[u+2],17,606105819),a=h(a,i,s,o,r[u+3],22,-1044525330);o=h(o,a,i,s,r[u+4],7,-176418897),s=h(s,o,a,i,r[u+5],12,1200080426),i=h(i,s,o,a,r[u+6],17,-1473231341),a=h(a,i,s,o,r[u+7],22,-45705983),o=h(o,a,i,s,r[u+8],7,1770035416),s=h(s,o,a,i,r[u+9],12,-1958414417),i=h(i,s,o,a,r[u+10],17,-42063),a=h(a,i,s,o,r[u+11],22,-1990404162),o=h(o,a,i,s,r[u+12],7,1804603682),s=h(s,o,a,i,r[u+13],12,-40341101),i=h(i,s,o,a,r[u+14],17,-1502002290),o=l(o,a=h(a,i,s,o,r[u+15],22,1236535329),i,s,r[u+1],5,-165796510),s=l(s,o,a,i,r[u+6],9,-1069501632),i=l(i,s,o,a,r[u+11],14,643717713),a=l(a,i,s,o,r[u+0],20,-373897302),o=l(o,a,i,s,r[u+5],5,-701558691),s=l(s,o,a,i,r[u+10],9,38016083),i=l(i,s,o,a,r[u+15],14,-660478335),a=l(a,i,s,o,r[u+4],20,-405537848),o=l(o,a,i,s,r[u+9],5,568446438),s=l(s,o,a,i,r[u+14],9,-1019803690),i=l(i,s,o,a,r[u+3],14,-187363961),a=l(a,i,s,o,r[u+8],20,1163531501),o=l(o,a,i,s,r[u+13],5,-1444681467),s=l(s,o,a,i,r[u+2],9,-51403784),i=l(i,s,o,a,r[u+7],14,1735328473),o=c(o,a=l(a,i,s,o,r[u+12],20,-1926607734),i,s,r[u+5],4,-378558),s=c(s,o,a,i,r[u+8],11,-2022574463),i=c(i,s,o,a,r[u+11],16,1839030562),a=c(a,i,s,o,r[u+14],23,-35309556),o=c(o,a,i,s,r[u+1],4,-1530992060),s=c(s,o,a,i,r[u+4],11,1272893353),i=c(i,s,o,a,r[u+7],16,-155497632),a=c(a,i,s,o,r[u+10],23,-1094730640),o=c(o,a,i,s,r[u+13],4,681279174),s=c(s,o,a,i,r[u+0],11,-358537222),i=c(i,s,o,a,r[u+3],16,-722521979),a=c(a,i,s,o,r[u+6],23,76029189),o=c(o,a,i,s,r[u+9],4,-640364487),s=c(s,o,a,i,r[u+12],11,-421815835),i=c(i,s,o,a,r[u+15],16,530742520),o=f(o,a=c(a,i,s,o,r[u+2],23,-995338651),i,s,r[u+0],6,-198630844),s=f(s,o,a,i,r[u+7],10,1126891415),i=f(i,s,o,a,r[u+14],15,-1416354905),a=f(a,i,s,o,r[u+5],21,-57434055),o=f(o,a,i,s,r[u+12],6,1700485571),s=f(s,o,a,i,r[u+3],10,-1894986606),i=f(i,s,o,a,r[u+10],15,-1051523),a=f(a,i,s,o,r[u+1],21,-2054922799),o=f(o,a,i,s,r[u+8],6,1873313359),s=f(s,o,a,i,r[u+15],10,-30611744),i=f(i,s,o,a,r[u+6],15,-1560198380),a=f(a,i,s,o,r[u+13],21,1309151649),o=f(o,a,i,s,r[u+4],6,-145523070),s=f(s,o,a,i,r[u+11],10,-1120210379),i=f(i,s,o,a,r[u+2],15,718787259),a=f(a,i,s,o,r[u+9],21,-343485551),o=o+p>>>0,a=a+v>>>0,i=i+d>>>0,s=s+m>>>0}return y.endian([o,a,i,s])})._ff=function(e,t,r,n,o,a,i){var s=e+(t&r|~t&n)+(o>>>0)+i;return(s<<a|s>>>32-a)+t},w._gg=function(e,t,r,n,o,a,i){var s=e+(t&n|r&~n)+(o>>>0)+i;return(s<<a|s>>>32-a)+t},w._hh=function(e,t,r,n,o,a,i){var s=e+(t^r^n)+(o>>>0)+i;return(s<<a|s>>>32-a)+t},w._ii=function(e,t,r,n,o,a,i){var s=e+(r^(t|~n))+(o>>>0)+i;return(s<<a|s>>>32-a)+t},w._blocksize=16,w._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var r=y.wordsToBytes(w(e,t));return t&&t.asBytes?r:t&&t.asString?x.bytesToString(r):y.bytesToHex(r)}});function we(e,t){var r=t.method,n=t.path,o=[r,encodeURI(n)];["date","policy","contentMd5"].forEach(function(e){t[e]&&o.push(t[e])});var a=le(e.password,o.join("&"));return"UPYUN "+e.operatorName+":"+a}var Ae={genSign:we,getHeaderSign:function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=(new Date).toGMTString();return{Authorization:we(e,{method:t,path:r="/"+e.serviceName+r,date:o,contentMd5:n}),"X-Date":o}},getPolicyAndAuthorization:function(e,t){if(t.service=e.serviceName,void 0===t["save-key"])throw new Error("upyun - calclate body sign need save-key");void 0===t.expiration&&(t.expiration=parseInt(new Date/1e3+1800,10));var r=ve.encode(JSON.stringify(t));return{policy:r,authorization:we(e,{method:"POST",path:"/"+e.serviceName,policy:r,contentMd5:t["content-md5"]})}},getPurgeHeaderSign:function(e,t){var r=(new Date).toGMTString(),n=t.join("\n"),o=xe(n+"&"+e.serviceName+"&"+r+"&"+e.password);return{Authorization:"UpYun "+e.serviceName+":"+e.operatorName+":"+o,Date:r,"User-Agent":"Js-Sdk/"+de}}},je=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function ke(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ce=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function Oe(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(je(this,Oe),void 0===e.serviceName)throw new Error("upyun - must config serviceName");if("function"==typeof t&&(r=t,t={}),"function"!=typeof r&&s)throw new Error("upyun - must config a callback function getHeaderSign in client side");if(!s&&(void 0===e.operatorName||void 0===e.password))throw new Error("upyun - must config operateName and password in server side");var n=Object.assign({domain:"v0.api.upyun.com",protocol:"https"},t);this.endpoint=n.protocol+"://"+n.domain;var o=n.proxy;this.proxy=o,this.req=V(this.endpoint,e,r||Pe,{proxy:o}),this.bucket=e,this.service=e,s||this.setBodySignCallback(Ae.getPolicyAndAuthorization)}function Se(e){return 0===e.indexOf("x-upyun-meta-")}function Pe(){return Ae.getHeaderSign.apply(Ae,arguments)}function qe(e){var t={},r=!0,n=!1,o=void 0;try{for(var a,i=Object.keys(e)[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;t[s.toLowerCase()]=e[s]}}catch(e){n=!0,o=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw o}}return t}function Te(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";je(this,Te),this.bucketName=e,this.serviceName=this.bucketName,this.operatorName=t,this.password=xe(r)}return{Client:(function(e,t,r){return t&&ke(e.prototype,t),r&&ke(e,r),e}(Oe,[{key:"setService",value:function(e){this.service=e,this.req.defaults.baseURL=this.endpoint+"/"+e.serviceName}},{key:"setBucket",value:function(e){return this.setService(e)}},{key:"setBodySignCallback",value:function(e){if("function"!=typeof e)throw new Error("upyun - getBodySign should be a function");this.bodySignCallback=e}},{key:"usage",value:function(e){var t=0<arguments.length&&void 0!==e?e:"/";return this.req.get(t+"?usage").then(function(e){var t=e.data;return Promise.resolve(t)})}},{key:"listDir",value:function(e,t){var r=0<arguments.length&&void 0!==e?e:"/",n=1<arguments.length&&void 0!==t?t:{},o=n.limit,a=void 0===o?100:o,i=n.order,s=void 0===i?"asc":i,u=n.iter,h=void 0===u?"":u,l={};return 100!==a&&(l["x-list-limit"]=a),"asc"!==s&&(l["x-list-order"]=s),h&&(l["x-list-iter"]=h),this.req.get(r,{headers:l}).then(function(e){var t=e.data,r=e.headers;if(404===e.status)return!1;var n=r["x-upyun-list-iter"];if(!t)return Promise.resolve({files:[],next:n});var o=t.split("\n").map(function(e){var t=e.split("\t"),r=Ce(t,4),n=r[0],o=r[1],a=r[2],i=r[3];return{name:n,type:o,size:parseInt(a),time:parseInt(i)}});return Promise.resolve({files:o,next:n})})}},{key:"putFile",value:function(e,t,r){var n=2<arguments.length&&void 0!==r?r:{},o=["Content-MD5","Content-Length","Content-Type","Content-Secret","x-gmkerl-thumb"],a={},i={},s=!0,u=!1,h=void 0;try{for(var l,c=Object.keys(n)[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var f=l.value;i[f.toLowerCase()]=n[f]}}catch(e){u=!0,h=e}finally{try{!s&&c.return&&c.return()}finally{if(u)throw h}}var p=!0,v=!1,d=void 0;try{for(var m,y=Object.keys(i)[Symbol.iterator]();!(p=(m=y.next()).done);p=!0){var g=m.value;Se(g)&&i[g]?a[g]=i[g]:o.forEach(function(e){var t=e.toLowerCase(),r=i[t];r&&(a[e]=r)})}}catch(e){v=!0,d=e}finally{try{!p&&y.return&&y.return()}finally{if(v)throw d}}return this.req.put(e,t,{headers:a}).then(function(e){var r=e.headers;if(200!==e.status)return Promise.resolve(!1);var n={};return["x-upyun-width","x-upyun-height","x-upyun-file-type","x-upyun-frames"].forEach(function(e){var t=e.split("x-upyun-")[1];r[e]&&(n[t]=r[e],"file-type"!==t&&(n[t]=parseInt(n[t],10)))}),Promise.resolve(!(0<Object.keys(n).length)||n)})}},{key:"initMultipartUpload",value:function(e,t,r){var o=this,n=void 0,a=qe(2<arguments.length&&void 0!==r?r:{}),i=a["x-upyun-multi-type"],i=s?(n=Promise.resolve(t.size),i||t.type):(n=ee.getFileSizeAsync(t),i||ee.getContentType(t));return n.then(function(n){return Object.assign(a,{"x-upyun-multi-disorder":!0,"x-upyun-multi-stage":"initiate","x-upyun-multi-length":n,"x-upyun-multi-type":i}),o.req.put(e,null,{headers:a}).then(function(e){var t=e.headers;if(204!==e.status)return Promise.resolve(!1);var r=t["x-upyun-multi-uuid"];return Promise.resolve({fileSize:n,partCount:Math.ceil(n/u),uuid:r})})})}},{key:"multipartUpload",value:function(t,r,n,o){var a=this,i=o*u;return(s?Promise.resolve(r.size):ee.getFileSizeAsync(r)).then(function(e){var t=Math.min(i+u,e);return ee.readBlockAsync(r,i,t)}).then(function(e){return a.req.put(t,e,{headers:{"x-upyun-multi-stage":"upload","x-upyun-multi-uuid":n,"x-upyun-part-id":o}}).then(function(e){var t=e.status;return Promise.resolve(204===t)})})}},{key:"completeMultipartUpload",value:function(e,t){return this.req.put(e,null,{headers:{"x-upyun-multi-stage":"complete","x-upyun-multi-uuid":t}}).then(function(e){var t=e.status;return Promise.resolve(204===t||201===t)})}},{key:"makeDir",value:function(e){return this.req.post(e,null,{headers:{folder:"true"}}).then(function(e){var t=e.status;return Promise.resolve(200===t)})}},{key:"copy",value:function(e,t,r){var n=qe(2<arguments.length&&void 0!==r?r:{}),o=Object.assign(n,{"x-upyun-copy-source":se.join("/",this.service.serviceName,t)});return this.req.put(e,null,{headers:o}).then(function(e){var t=e.status;return Promise.resolve(200<=t&&t<300)})}},{key:"move",value:function(e,t,r){var n=qe(2<arguments.length&&void 0!==r?r:{}),o=Object.assign(n,{"x-upyun-move-source":se.join("/",this.service.serviceName,t)});return this.req.put(e,null,{headers:o}).then(function(e){var t=e.status;return Promise.resolve(200<=t&&t<300)})}},{key:"headFile",value:function(e){return this.req.head(e).then(function(e){var r=e.headers;if(404===e.status)return Promise.resolve(!1);var n={"Content-Md5":r["content-md5"]||""};return["x-upyun-file-type","x-upyun-file-size","x-upyun-file-date"].forEach(function(e){var t=e.split("x-upyun-file-")[1];r[e]&&(n[t]=r[e],"size"!==t&&"date"!==t||(n[t]=parseInt(n[t],10)))}),Promise.resolve(n)})}},{key:"deleteFile",value:function(e,t){var r={};return 1<arguments.length&&void 0!==t&&t&&(r["x-upyun-async"]=!0),this.req.delete(e,{headers:r}).then(function(e){var t=e.status;return Promise.resolve(200===t)})}},{key:"deleteDir",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.deleteFile.apply(this,t)}},{key:"getFile",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:null;if(n&&s)throw new Error("upyun - save as stream are only available on the server side.");return this.req({method:"GET",url:e,responseType:n?"stream":null}).then(function(e){if(404===e.status)return Promise.resolve(!1);if(!n)return Promise.resolve(e.data);var r=e.data.pipe(n);return new Promise(function(e,t){r.on("finish",function(){return e(r)}),r.on("error",t)})})}},{key:"updateMetadata",value:function(e,t,r){var n=2<arguments.length&&void 0!==r?r:"merge",o={};for(var a in t)Se(a)?o[a]=t:o["x-upyun-meta-"+a]=t[a];return this.req.patch(e+"?metadata="+n,null,{headers:o}).then(function(e){var t=e.status;return Promise.resolve(200===t)})}},{key:"getMetadata",value:function(e){return this.req.get(e).then(function(e){var t=e.headers;if(200!==e.status)return Promise.resolve(!1);var r={};for(var n in t)Se(n)&&(r[n]=t[n]);return Promise.resolve(r)})}},{key:"blockUpload",value:function(h,l,e){var c=this,t=2<arguments.length&&void 0!==e?e:{},r=void 0,n=void 0,n=s?(r=Promise.resolve(l.size),l.type):(r=ee.getFileSizeAsync(l),ee.getContentType(l));return r.then(function(i){Object.assign(t,{"x-upyun-multi-stage":"initiate","x-upyun-multi-length":i,"x-upyun-multi-type":n});var s=1048576,u=Math.ceil(i/s);return c.req.put(h,null,{headers:t}).then(function(e){for(var t=e.headers,n=t["x-upyun-multi-uuid"],r=t["x-upyun-next-part-id"],o=Promise.resolve(r),a=0;a<u;a++)o=o.then(function(r){var e=r*s,t=Math.min(e+s,i);return ee.readBlockAsync(l,e,t).then(function(e){return c.req.put(h,e,{headers:{"x-upyun-multi-stage":"upload","x-upyun-multi-uuid":n,"x-upyun-part-id":r}}).then(function(e){var t=e.headers;return r=t["x-upyun-next-part-id"],Promise.resolve(r)})})});return o.then(function(){return c.req.put(h,null,{headers:{"x-upyun-multi-stage":"complete","x-upyun-multi-uuid":n}}).then(function(e){var t=e.status;return Promise.resolve(204===t||201===t)})})})})}},{key:"formPutFile",value:function(e,t,r,n){var o=this,a=2<arguments.length&&void 0!==r?r:{},i=3<arguments.length&&void 0!==n?n:{},s={},u=!0,h=!1,l=void 0;try{for(var c,f=Object.keys(a)[Symbol.iterator]();!(u=(c=f.next()).done);u=!0){var p=c.value;s[p.toLowerCase()]=a[p]}}catch(e){h=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(h)throw l}}if("function"!=typeof this.bodySignCallback)throw new Error("upyun - must setBodySignCallback first!");s.service=this.service.serviceName,s["save-key"]=e;var v=this.bodySignCallback(this.service,s);return(v=m(v)?v:Promise.resolve(v)).then(function(e){return function(e,t,r,n){var o=r.authorization,a=r.policy,i=(3<arguments.length&&void 0!==n?n:{}).filename,s=new FormData;return s.append("authorization",o),s.append("policy",a),"string"==typeof t&&(t=new Blob([t],{type:"text/plain"})),i=i?se.basename(i):i,s.append("file",t,i),d.post(e,s).then(function(e){var t=e.status,r=e.data;return 200===t&&Promise.resolve(r)})}(o.endpoint+"/"+s.service,t,e,i)})}},{key:"purge",value:function(e){"string"==typeof e&&(e=[e]);var t=Ae.getPurgeHeaderSign(this.service,e);return d.post("http://purge.upyun.com/purge/","purge="+e.join("\n"),{headers:t,proxy:this.proxy}).then(function(e){var t=e.data;if(0===Object.keys(t.invalid_domain_of_url).length)return!0;throw new Error("some url purge failed "+t.invalid_domain_of_url.join(" "))},function(e){throw new Error("upyun - request failed: "+e.message)})}}]),Oe),sign:Ae,Bucket:Te,Service:Te}});